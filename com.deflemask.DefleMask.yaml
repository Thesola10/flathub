app-id: "com.deflemask.DefleMask"
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
command: "/app/share/DefleMask/DefleMask"
separate-locales: false
tags:
  - proprietary

build-options:
    prepend-pkg-config-path: "/app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig"
    ldflags: "-L/app/lib32"
    prepend-path: "/usr/lib/sdk/toolchain-i386/bin"
    env:
        CC: "i686-unknown-linux-gnu-gcc"
        CXX: "i686-unknown-linux-gnu-g++"

finish-args:
  - "--share=ipc"
  - "--socket=x11"
  - "--socket=wayland"
  - "--socket=pulseaudio"
  - "--filesystem=home"
  - "--device=dri"

sdk-extensions:
  - 'org.freedesktop.Sdk.Compat.i386'
  - 'org.freedesktop.Sdk.Extension.toolchain-i386'

add-extensions:
    'org.freedesktop.Platform.Compat.i386':
        directory: "lib/i386-linux-gnu"
        version: '19.08'

    'org.freedesktop.Platform.GL32':
        directory: "lib/i386-linux-gnu/GL"
        version: '1.4'
        versions: '19.08;1.4'
        subdirectories: true
        no-autodownload: true
        autodelete: false
        merge-dirs: "vulkan/icd.d;glvnd/egl_vendor.d"
        download-if: active-gl-driver
        enable-if: active-gl-driver

modules:
  - shared-modules/glu/glu-9.json
  - shared-modules/SDL/SDL-1.2.15.json
  - shared-modules/gtk2/gtk2.json
  - name: "app"
    buildsystem: simple
    build-commands:
      - "mkdir -p /app/share/DefleMask"
      - "cp -R * /app/share/DefleMask"
    sources:
      - type: archive
        url: http://deflemask.com/DefleMask_Linux.tar.gz
        sha256: "7c92b81843345d5c4f239d5deebc264f02556a98f7c4272523978bb963a6feee"
        strip-components: 0
  - name: "metadata"
    buildsystem: simple
    build-commands:
      - "install -D com.deflemask.DefleMask.png /app/share/icons/hicolor/512x512/apps/com.deflemask.DefleMask.png"
      - "install -D com.deflemask.DefleMask.desktop /app/share/applications/com.deflemask.DefleMask.desktop"
      - "install -D com.deflemask.DefleMask.metainfo.xml /app/share/metainfo/com.deflemask.DefleMask.metainfo.xml"
    sources:
      - type: file
        path: "com.deflemask.DefleMask.png"
      - type: file
        path: "com.deflemask.DefleMask.desktop"
      - type: file
        path: "com.deflemask.DefleMask.metainfo.xml"
